<div class="container mt-4" data-controller="score" data-action="input->score#updateScore">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">La Canadienne 273 Av. Laurier O, Montréal store 002</h2>
    <span id="dq-score" class="badge bg-info text-dark" data-score-target="score">DQ: 0%</span>
    <div class="fixed-icon">
      <i class="bi bi-calendar-event"></i>
    </div>
  </div>

  <h3>Personal Data / Données Personnelles</h3>

  <!-- Disable Turbo with data-turbo="false" -->
  <%= form_with model: @client, local: true, data: { turbo: false } do |form| %>
    <div class="row mb-3">
      <div class="col-md-6">
        <%= link_to 'PDF File / Fichier PDF', '#', class: 'pdf-link float-end' %>
      </div>
    </div>

    <div class="row">
      <!-- Type Field -->
      <div class="col-md-6 mb-3">
        <%= form.label :type, "Type * / Type *", class: "form-label" %>
        <%= form.select :type, options_for_select(["Client", "VIP", "Partner", "Partenaire"]), {}, class: 'form-control', disabled: @readonly %>
      </div>

      <!-- Title Field -->
      <div class="col-md-6 mb-3">
        <%= form.label :title, "Title * / Titre *", class: "form-label" %>
        <%= form.select :title, options_for_select(["Mr.", "Mrs.", "Miss", "Dr.", "M.", "Mme", "Mlle"]), {}, class: 'form-control', disabled: @readonly %>
      </div>

      <!-- Name Fields -->
      <div class="col-md-6 mb-3">
        <%= form.label :first_name, "Name * / Prénom *", class: "form-label" %>
        <%= form.text_field :first_name, class: 'form-control', placeholder: "Enter First Name", data: { score_target: "firstName" }, disabled: @readonly %>
      </div>
      <div class="col-md-6 mb-3">
        <%= form.label :first_name_local, "Name (local) / Prénom (local)", class: "form-label" %>
        <%= form.text_field :first_name_local, class: 'form-control', placeholder: "Enter Local First Name", disabled: @readonly %>
      </div>

      <!-- Surname Fields -->
      <div class="col-md-6 mb-3">
        <%= form.label :last_name, "Surname * / Nom de Famille *", class: "form-label" %>
        <%= form.text_field :last_name, class: 'form-control', placeholder: "Enter Last Name", data: { score_target: "lastName" }, disabled: @readonly %>
      </div>
      <div class="col-md-6 mb-3">
        <%= form.label :last_name_local, "Surname (local) / Nom de Famille (local)", class: "form-label" %>
        <%= form.text_field :last_name_local, class: 'form-control', placeholder: "Enter Local Last Name", disabled: @readonly %>
      </div>

      <!-- Birthday and Email Fields -->
      <div class="col-md-6 mb-3">
        <%= form.label :birthday, "Birthday / Date de Naissance", class: "form-label" %>
        <%= form.date_field :birthday, class: 'form-control', placeholder: "Enter Birthday", data: { score_target: "birthday" }, disabled: @readonly %>
      </div>
      <div class="col-md-6 mb-3">
        <%= form.label :email, "E-mail / E-mail", class: "form-label" %>
        <%= form.email_field :email, class: 'form-control', placeholder: "Enter Email", data: { score_target: "email" }, disabled: @readonly %>
      </div>

      <!-- Phone and Address Fields -->
      <div class="col-md-6 mb-3">
        <%= form.label :phone, "Phone / Téléphone", class: "form-label" %>
        <%= form.text_field :phone, class: 'form-control', placeholder: "Enter Phone Number", data: { score_target: "phone" }, disabled: @readonly %>
      </div>
      <div class="col-md-6 mb-3">
        <%= form.label :address, "Address / Adresse", class: "form-label" %>
        <%= form.text_field :address, class: 'form-control', placeholder: "Enter Address", data: { score_target: "address" }, disabled: @readonly %>
      </div>

      <!-- Postal Code and Notes Fields -->
      <div class="col-md-6 mb-3">
        <%= form.label :postal_code, "Postal Code / Code Postal", class: "form-label" %>
        <%= form.text_field :postal_code, class: 'form-control', placeholder: "Enter Postal Code", data: { score_target: "postalCode" }, disabled: @readonly %>
      </div>
      <div class="col-md-6 mb-3">
        <%= form.label :notes, "Notes / Remarques", class: "form-label" %>
        <%= form.text_area :notes, class: 'form-control', placeholder: "Enter Notes", data: { score_target: "notes" }, disabled: @readonly %>
      </div>

      <!-- More Info Button -->
      <div class="col-md-12 mb-3 text-center">
        <button type="button" class="custom-info-button" id="more-info-toggle">More Info</button>
      </div>

      <!-- More Info Section (Initially Hidden) -->
      <div id="more-info-section" style="display: none;">
        <!-- Contact Preferences -->
        <div class="col-md-6 mb-3">
          <%= form.label :contact_preference, "Contact Preference", class: "form-label" %>
          <%= form.select :contact_preference, options_for_select(["Phone", "Message", "Email", "Email/Work", "Home"]), {}, class: 'form-control', disabled: @readonly %>
        </div>

        <!-- Time to Contact -->
        <div class="col-md-6 mb-3">
          <%= form.label :time_to_contact, "Preferred Time to Contact", class: "form-label" %>
          <%= form.select :time_to_contact, options_for_select(["Morning", "Afternoon", "Evening"]), {}, class: 'form-control', disabled: @readonly %>
        </div>

        <!-- Payment Type -->
        <div class="col-md-12 mb-3">
          <%= form.label :payment_type, "Usual Payment Type", class: "form-label d-block" %>
          <div class="form-check form-check-inline">
            <%= form.check_box :payment_type_amex, { class: "form-check-input", disabled: @readonly }, true, false %>
            <%= form.label :payment_type_amex, "AMEX", class: "form-check-label" %>
          </div>
          <div class="form-check form-check-inline">
            <%= form.check_box :payment_type_visa, { class: "form-check-input", disabled: @readonly }, true, false %>
            <%= form.label :payment_type_visa, "Visa", class: "form-check-label" %>
          </div>
          <div class="form-check form-check-inline">
            <%= form.check_box :payment_type_mastercard, { class: "form-check-input", disabled: @readonly }, true, false %>
            <%= form.label :payment_type_mastercard, "Mastercard", class: "form-check-label" %>
          </div>
          <div class="form-check form-check-inline">
            <%= form.check_box :payment_type_discover, { class: "form-check-input", disabled: @readonly }, true, false %>
            <%= form.label :payment_type_discover, "Discover", class: "form-check-label" %>
          </div>
          <div class="form-check form-check-inline">
            <%= form.check_box :payment_type_other, { class: "form-check-input", disabled: @readonly }, true, false %>
            <%= form.label :payment_type_other, "Other", class: "form-check-label" %>
          </div>
        </div>
      </div>

      <!-- Signature Section -->
      <div data-controller="signature" 
           data-signature-readonly="<%= @readonly %>" 
           data-signature-signature="<%= @client.signature %>">
        <label for="signature" class="form-label">Signature</label>
        <canvas id="signature-pad" class="signature-pad mb-2" data-signature-target="canvas" width="400" height="200" style="border: 1px solid black; background-color: white;"></canvas>
        <button type="button" id="clear-signature" class="btn btn-warning mt-2" data-action="signature#clearSignature" <%= 'disabled' if @readonly %>>Clear Signature</button>
      </div>

      <!-- Back, Save, and Search Buttons -->
      <div class="d-flex justify-content-center mt-4">
        <div class="button-group d-flex justify-content-around w-100">
          <%= link_to 'BACK', dashboard_path, class: 'custom-back-button' %>
          <% unless @readonly %>
            <%= form.submit 'SAVE', class: 'custom-save-button' %>
          <% end %>
          <%= link_to 'SEARCH CLIENT', search_clients_path, class: 'custom-search-button' %>
        </div>
      </div>
    </div>
  <% end %>

  <% if flash[:notice] %>
    <div class="alert alert-success mt-4">
      <%= flash[:notice] %>
    </div>
  <% end %>
</div>

<script>
  document.getElementById("more-info-toggle").addEventListener("click", function() {
    var moreInfoSection = document.getElementById("more-info-section");
    if (moreInfoSection.style.display === "none" || moreInfoSection.style.display === "") {
      moreInfoSection.style.display = "block";
      this.textContent = "Hide Info";
    } else {
      moreInfoSection.style.display = "none";
      this.textContent = "More Info";
    }
  });
</script>


<style>
#signature-pad {
  display: block;
  margin: 0 auto;
  background-color: white;
  border: 1px solid black;
  width: 400px;
  height: 200px;
}

/* General button styling */
.custom-back-button, .custom-save-button, .custom-search-button, .custom-info-button {
  background-color: #4a4a4a;
  color: white;
  text-decoration: none;
  padding: 12px 25px;
  font-size: 0.9rem;
  font-weight: 600;
  border-radius: 5px;
  border: none;
  cursor: pointer;
  transition: background-color 0.3s ease;
  text-align: center;
  width: 100%;
  max-width: 200px;
}

.custom-back-button:hover, .custom-save-button:hover, .custom-search-button:hover, .custom-info-button:hover {
  background-color: #333;
}

/* Container layout */
.container {
  padding: 15px;
  margin: 0 auto;
  max-width: 800px;
}

/* Center signature section */
#signature-pad {
  margin: 0 auto;
}

/* Button group layout */
.button-group {
  display: flex;
  justify-content: space-between;
  gap: 20px; /* Add space between buttons */
  max-width: 600px; /* Ensure buttons don't spread too wide */
  width: 100%;
}

/* Hide 'More Info' section initially */
#more-info-section {
  display: none;
}

/* Horizontal checkboxes for payment types */
.form-check-inline {
  margin-right: 15px;
}
</style>
